\documentclass[a4paper]{article}
% generated by Docutils <https://docutils.sourceforge.io/>
% rubber: set program xelatex
\usepackage{fontspec}
% \defaultfontfeatures{Scale=MatchLowercase}
% straight double quotes (defined T1 but missing in TU):
\ifdefined \UnicodeEncodingName
  \DeclareTextCommand{\textquotedbl}{\UnicodeEncodingName}{%
    {\addfontfeatures{RawFeature=-tlig,Mapping=}\char34}}%
\fi
\usepackage{ifthen}
\usepackage{alltt}
\usepackage{color}
\setcounter{secnumdepth}{0}

%%% Custom LaTeX preamble

\setmainfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\setmonofont[Scale=MatchLowercase]{Fira Code}

%%% User specified packages and stylesheets
\usepackage{alectryon}
\usepackage{pygments}

%%% Fallback definitions for Docutils-specific commands

% basic code highlight:
\providecommand*\DUrolecomment[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUroledeleted[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUrolekeyword[1]{\textbf{#1}}
\providecommand*\DUrolestring[1]{\textit{#1}}

% custom inline roles: \DUrole{#1}{#2} tries \DUrole#1{#2}
\providecommand*{\DUrole}[2]{%
  \ifcsname DUrole#1\endcsname%
    \csname DUrole#1\endcsname{#2}%
  \else%
    #2%
  \fi%
}

% transition (break / fancybreak / anonymous section)
\providecommand*{\DUtransition}{%
  \hspace*{\fill}\hrulefill\hspace*{\fill}
  \vskip 0.5\baselineskip
}
% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \usepackage{bookmark}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={Literate programming with Alectryon (Lean3 input)},
}

\title{Literate programming with Alectryon (Lean3 input)%
  \label{literate-programming-with-alectryon-lean3-input}}
\author{}
\date{}

%%% Body
\begin{document}
\maketitle

Alectryon supports literate programs and documents (combinations of code and prose) written in Lean3 and reStructuredText.  Here is an example written in Lean3.  It can be converted to reST, HTML, or LaTeX using the following commands:

\begin{quote}
\begin{alltt}
alectryon --frontend lean3+rst literate_lean3.lean
    # Coq+reST → HTML;  produces ‘literate_lean3.html’
alectryon --frontend lean3+rst literate_lean3.lean --backend latex \textbackslash{}
     --latex-dialect xelatex \textbackslash{}
     -o literate_lean3.xe.tex
    # Coq+reST → LaTeX; produces ‘literate_lean3.xe.tex’
alectryon --frontend lean3+rst literate_lean3.lean --backend rst
    # Coq+reST → reST;  produces ‘literate_lean3.lean3.rst’
\end{alltt}
\end{quote}

%___________________________________________________________________________
\DUtransition


\section{Running queries%
  \label{running-queries}%
}

Alectryon captures the results of \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{lean3}{\DUrole{k}{\#check}}}}}, \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{lean3}{\DUrole{k}{\#eval}}}}}, and the like:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}reduce}~\PY{k}{let}~\PY{n}{x}~\PY{o}{:=}~\PY{l+m+mi}{5}~\PY{k}{in}~\PY{n}{x}~\PY{n+nb+bp}{+}~\PY{l+m+mi}{3}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{l+m+mi}{8}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}

By default, these results are folded and are displayed upon hovering or clicking.  We can unfold them by default using annotations or directives:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}check}~\PY{n}{nat}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{ℕ}~\PY{o}{:}~\PY{k+kt}{Type}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}check}~\PY{n}{bool}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{bool}~\PY{o}{:}~\PY{k+kt}{Type}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}eval}~\PY{l+m+mi}{1}~\PY{n+nb+bp}{+}~\PY{l+m+mi}{1}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{l+m+mi}{2}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}

Other flags can be used to control display, like \texttt{.no-in}:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{k+kd}{structure}~\PY{n}{iff}~\PY{o}{:}~\PY{k+kt}{Prop}~\PY{n+nb+bp}{→}~\PY{k+kt}{Prop}~\PY{n+nb+bp}{→}~\PY{k+kt}{Prop}\nl
          \PY{n}{fields}\PY{o}{:}\nl
          \PY{n}{iff.mp}~\PY{o}{:}~\PY{n+nb+bp}{∀}~\PY{o}{\PYZob{}}\PY{n}{a}~\PY{n}{b}~\PY{o}{:}~\PY{k+kt}{Prop}\PY{o}{\PYZcb{},}~\PY{o}{(}\PY{n}{a}~\PY{n+nb+bp}{↔}~\PY{n}{b}\PY{o}{)}~\PY{n+nb+bp}{→}~\PY{n}{a}~\PY{n+nb+bp}{→}~\PY{n}{b}\nl
          \PY{n}{iff.mpr}~\PY{o}{:}~\PY{n+nb+bp}{∀}~\PY{o}{\PYZob{}}\PY{n}{a}~\PY{n}{b}~\PY{o}{:}~\PY{k+kt}{Prop}\PY{o}{\PYZcb{},}~\PY{o}{(}\PY{n}{a}~\PY{n+nb+bp}{↔}~\PY{n}{b}\PY{o}{)}~\PY{n+nb+bp}{→}~\PY{n}{b}~\PY{n+nb+bp}{→}~\PY{n}{a}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}


\section{Documenting proofs%
  \label{documenting-proofs}%
}

Alectryon also captures goals and hypotheses as proofs progress:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kd}{example}~\PY{o}{(}\PY{n}{p}~\PY{n}{q}~\PY{n}{r}~\PY{o}{:}~\PY{k+kt}{Prop}\PY{o}{)}~\PY{o}{:}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{↔}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{o}{:=}\nl
    \end{input}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n}{apply}~\PY{n}{iff.intro}\PY{o}{,}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{→}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \end{hyps}
            \sep
            \infrule{}
            \sep
            \begin{conclusion}
              \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{n+nb+bp}{→}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{o}{\PYZob{}}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{→}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \anchor{literate-lean3-lean-s-intro-h-0}~~~~\PY{n}{intro}~\PY{n}{H}\PY{o}{,}\mrefmarker{1}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{n}{and.intro}\PY{o}{,}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\anchor{literate-lean3-lean-s-and-intro-h-h-0}\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}\mrefmarker{2}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{q}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q, r}{\PY{k+kt}{Prop}}
              \sep
              \hyp{H}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
            \end{hyps}
            \sep
            \infrule{}
            \sep
            \begin{conclusion}
              \PY{n}{p}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{o}{(}\PY{n}{and.elim\PYZus{}right}~\PY{n}{H}\PY{o}{),}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{o}{(}\PY{n}{and.elim\PYZus{}left}~\PY{n}{H}\PY{o}{),}\nl
    \end{input}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{o}{\PYZcb{},}~
    \end{input}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{o}{\PYZob{}}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{n+nb+bp}{→}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{intro}~\PY{n}{H}\PY{o}{,}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{n}{and.intro}\PY{o}{,}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q, r}{\PY{k+kt}{Prop}}
              \sep
              \hyp{H}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
            \end{hyps}
            \sep
            \infrule{}
            \sep
            \begin{conclusion}
              \PY{n}{q}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{o}{(}\PY{n}{and.elim\PYZus{}right}~\PY{n}{H}\PY{o}{),}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q, r}{\PY{k+kt}{Prop}}
            \sep
            \hyp{H}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{o}{(}\PY{n}{and.elim\PYZus{}left}~\PY{n}{H}\PY{o}{),}\nl
    \end{input}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{o}{\PYZcb{}}\nl
      \PY{k+kd}{end}
    \end{input}
  \end{sentence}
\end{alectryon}

Most features available for Coq are also available for Lean3; in particular, references (\hyperref[literate-lean3-lean-s-intro-h-0]{1}, \hyperref[literate-lean3-lean-s-and-intro-h-h-0]{2}), quotes (\alectryonInline{\PY{n}{p}~\PY{o}{∧}~\PY{n}{q}}) and assertions should work.

\begin{alectryon}
  \PY{n}{q}~\PY{o}{∧}~\PY{n}{p}~\PY{o}{→}~\PY{n}{p}~\PY{o}{∧}~\PY{n}{q}
\end{alectryon}

For now, please refer to the main README and to the Coq examples for more information.

\end{document}
