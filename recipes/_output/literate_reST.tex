\documentclass[a4paper]{article}
% generated by Docutils <http://docutils.sourceforge.net/>
\usepackage{cmap} % fix search and cut-and-paste in Acrobat
\usepackage{ifthen}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{alltt}
\usepackage{color}
\usepackage{longtable,ltcaption,array}
\setlength{\extrarowheight}{2pt}
\newlength{\DUtablewidth} % internal use in tables
\usepackage{textcomp} % text symbol macros

%%% Custom LaTeX preamble
% PDF Standard Fonts
\usepackage{mathptmx} % Times
\usepackage[scaled=.90]{helvet}
\usepackage{courier}

%%% User specified packages and stylesheets
\usepackage{alectryon}
\usepackage{tango_subtle}

%%% Fallback definitions for Docutils-specific commands
% basic code highlight:
\providecommand*\DUrolecomment[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUroledeleted[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUrolekeyword[1]{\textbf{#1}}
\providecommand*\DUrolestring[1]{\textit{#1}}

% inline markup (custom roles)
% \DUrole{#1}{#2} tries \DUrole#1{#2}
\providecommand*{\DUrole}[2]{%
  \ifcsname DUrole#1\endcsname%
    \csname DUrole#1\endcsname{#2}%
  \else
    % backwards compatibility: try \docutilsrole#1{#2}
    \ifcsname docutilsrole#1\endcsname%
      \PackageWarningNoLine{docutils}{Command prefix "docutilsrole" is
         deprecated, \MessageBreak use `\protect\DUrole #1`}
      \csname docutilsrole#1\endcsname{#2}%
    \else%
      #2%
    \fi%
  \fi%
}

% transition (break, fancybreak, anonymous section)
\providecommand*{\DUtransition}{%
  \hspace*{\fill}\hrulefill\hspace*{\fill}
  \vskip 0.5\baselineskip
}

% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \usepackage{bookmark}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={Literate programming with Alectryon (reST input)},
}

%%% Body
\begin{document}
\title{Literate programming with Alectryon (reST input)%
  \label{literate-programming-with-alectryon-rest-input}}
\author{}
\date{}
\maketitle

\makeatletter\def\alectryon@nobreakspace{\alectryon@breakspace}\makeatother

Alectryon supports literate programs and documents (combinations of code and prose) written in Coq and reStructuredText.  Here is an example, written in reST.  It can be converted to Coq, HTML, or LaTeX using the following commands:

\begin{quote}
\begin{alltt}
alectryon literate_reST.rst
  # reST+Coq → HTML;  produces ‘literate_reST.html’
alectryon literate_reST.rst -{}-backend latex
  # reST+Coq → LaTeX; produces ‘literate_reST.tex’
alectryon literate_reST.rst -{}-backend coq
  # reST+Coq → Coq;   produces ‘literate_reST.v’
\end{alltt}
\end{quote}

%___________________________________________________________________________
\DUtransition

Coq fragments are introduced with \texttt{.. coq::}:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Lemma}~\PY{n+nf}{le\PYZus{}l}~\PY{o}{:}~\PY{k+kr}{forall}~\PY{n+nv}{y}~\PY{n+nv}{x}\PY{o}{,}~\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \begin{conclusion}
            \PY{k+kr}{forall}~\PY{n+nv}{y}~\PY{n+nv}{x}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n+nb}{induction}~\PY{n}{y}\PY{o}{;}~\PY{n+nb}{inversion}~\PY{l+m+mi}{1}\PY{o}{;}~\PY{n+nb}{subst}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{y}{\PY{n}{nat}}
            \sep
            \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}}
            \sep
            \hyp{H}{\PY{n}{S}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{y}{\PY{n}{nat}}
              \sep
              \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}}
              \sep
              \hyp{x}{\PY{n}{nat}}
              \sep
              \hyp{H}{\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}}
              \sep
              \hyp{H1}{\PY{n}{S}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}}
            \end{hyps}
            \sep
            \begin{conclusion}
              \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{k+kp}{all}\PY{o}{:}~\PY{n+nb}{info\PYZus{}eauto}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{c}{(*~info~eauto:~*)}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb}{simple~apply}~\PY{n}{le\PYZus{}S}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb}{simple~apply}~\PY{n}{le\PYZus{}n}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{c}{(*~info~eauto:~*)}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb}{simple~apply}~\PY{n}{le\PYZus{}S}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb}{simple~apply}~\PY{n}{IHy}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb+bp}{exact}~\PY{n}{H1}\PY{o}{.}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Qed}\PY{o}{.}\nl
    \end{input}
  \end{sentence}
  \sep
  \begin{txt}
    \nl
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kn}{Goal}~\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{y}~\PY{n+nv}{z}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \begin{conclusion}
            \PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{y}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
\end{alectryon}

They can be nested nested into other reST directives, such as tables:

\setlength{\DUtablewidth}{0.900\linewidth}
\begin{longtable}[c]{|p{0.470\DUtablewidth}|p{0.470\DUtablewidth}|}
\caption{Coq commands}\\
\hline
\textbf{%
Coq command
} & \textbf{%
Description
} \\
\hline
\endfirsthead
\caption[]{Coq commands (... continued)}\\
\hline
\textbf{%
Coq command
} & \textbf{%
Description
} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n+nb}{intros}~\PY{n}{x}~\PY{n}{y}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{x, y}{\PY{n}{nat}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{k+kr}{forall}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
\end{alectryon}
 & 
Move the variables \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{x}}}}} and \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{y}}}}} into the context.
 \\
\hline

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n+nb}{revert}~\PY{n}{x}\PY{o}{;}~\PY{n+nb}{induction}~\PY{n}{y}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \begin{conclusion}
            \PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{l+m+mi}{0}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{y}{\PY{n}{nat}}
              \sep
              \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
            \end{hyps}
            \sep
            \begin{conclusion}
              \PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
\end{alectryon}
 & 
Perform induction on \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{y}}}}}, generalizing \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{x}}}}}.
 \\
\hline

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k+kp}{all}\PY{o}{:}~\PY{n+nb}{intros}~\PY{n}{x}~\PY{n}{z}~\PY{o}{(}\PY{n}{Hl}~\PY{o}{\PYZam{}}~\PY{n}{Hr}\PY{o}{).}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{x, z}{\PY{n}{nat}}
            \sep
            \hyp{Hl}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{l+m+mi}{0}}
            \sep
            \hyp{Hr}{\PY{l+m+mi}{0}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{y}{\PY{n}{nat}}
              \sep
              \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
              \sep
              \hyp{x, z}{\PY{n}{nat}}
              \sep
              \hyp{Hl}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}}
              \sep
              \hyp{Hr}{\PY{n}{S}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
            \end{hyps}
            \sep
            \begin{conclusion}
              \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
\end{alectryon}
 & 
Move conjunction into the context, splitting it into \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{Hl}}}}} and \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{Hr}}}}}.
 \\
\hline

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{o}{\PYZhy{}}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{x, z}{\PY{n}{nat}}
            \sep
            \hyp{Hl}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{l+m+mi}{0}}
            \sep
            \hyp{Hr}{\PY{l+m+mi}{0}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n+nb}{inversion}~\PY{n}{Hl}\PY{o}{;}~\PY{n+nb+bp}{assumption}\PY{o}{.}
    \end{input}
  \end{sentence}
\end{alectryon}
 & 
Solve base case; \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{\DUrole{builtin}{inversion}}}}}} changes \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{x} \DUrole{operator}{<=} \DUrole{literal}{\DUrole{number}{\DUrole{integer}{0}}}}}}} into \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{x} \DUrole{operator}{=} \DUrole{literal}{\DUrole{number}{\DUrole{integer}{0}}}}}}}.
 \\
\hline

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    ~~
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{o}{\PYZhy{}}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{y}{\PY{n}{nat}}
            \sep
            \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
            \sep
            \hyp{x, z}{\PY{n}{nat}}
            \sep
            \hyp{Hl}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}}
            \sep
            \hyp{Hr}{\PY{n}{S}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n+nb}{inversion}~\PY{n}{Hl}\PY{o}{;}~\PY{n+nb}{subst}\PY{o}{;}~\PY{k+kp}{try}~\PY{n+nb+bp}{congruence}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{y}{\PY{n}{nat}}
            \sep
            \hyp{IHy}{\PY{k+kr}{forall}~\PY{n+nv}{x}~\PY{n+nv}{z}~\PY{o}{:}~\PY{n}{nat}\PY{o}{,}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}~\PY{o}{\PYZhy{}\PYZgt{}}~\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
            \sep
            \hyp{x, z}{\PY{n}{nat}}
            \sep
            \hyp{Hl}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{S}~\PY{n}{y}}
            \sep
            \hyp{Hr}{\PY{n}{S}~\PY{n}{y}~\PY{o}{\PYZlt{}=}~\PY{n}{z}}
            \sep
            \hyp{H0}{\PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{y}}
          \end{hyps}
          \sep
          \begin{conclusion}
            \PY{n}{x}~\PY{o}{\PYZlt{}=}~\PY{n}{z}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb}{apply}~\PY{n}{IHy}\PY{o}{;}~\PY{n+nb}{split}\PY{o}{;}~\PY{n+nb}{info\PYZus{}eauto~using}~\PY{n}{le\PYZus{}l}\PY{o}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{c}{(*~info~eauto:~*)}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb+bp}{exact}~\PY{n}{H0}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{c}{(*~info~eauto:~*)}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb}{simple~apply}~\PY{n}{le\PYZus{}l}\PY{o}{.}
        \end{message}
        \sep
        \begin{message}
          \PY{n+nb+bp}{exact}~\PY{n}{Hr}\PY{o}{.}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
\end{alectryon}
 & 
Solve inductive case using the \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{coq}{\DUrole{name}{le\_l}}}}} lemma.
 \\
\hline
\end{longtable}

\end{document}
