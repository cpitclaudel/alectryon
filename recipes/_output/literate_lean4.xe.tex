\documentclass[a4paper]{article}
% generated by Docutils <https://docutils.sourceforge.io/>
% rubber: set program xelatex
\usepackage{fontspec}
% \defaultfontfeatures{Scale=MatchLowercase}
% straight double quotes (defined T1 but missing in TU):
\ifdefined \UnicodeEncodingName
  \DeclareTextCommand{\textquotedbl}{\UnicodeEncodingName}{%
    {\addfontfeatures{RawFeature=-tlig,Mapping=}\char34}}%
\fi
\usepackage{ifthen}
\usepackage{alltt}
\usepackage{color}
\setcounter{secnumdepth}{0}

%%% Custom LaTeX preamble

\setmainfont{Linux Libertine O}
\setsansfont{Linux Biolinum O}
\setmonofont[Scale=MatchLowercase]{Fira Code}

%%% User specified packages and stylesheets
\usepackage{alectryon}
\usepackage{pygments}

%%% Fallback definitions for Docutils-specific commands

% basic code highlight:
\providecommand*\DUrolecomment[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUroledeleted[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\providecommand*\DUrolekeyword[1]{\textbf{#1}}
\providecommand*\DUrolestring[1]{\textit{#1}}

% custom inline roles: \DUrole{#1}{#2} tries \DUrole#1{#2}
\providecommand*{\DUrole}[2]{%
  \ifcsname DUrole#1\endcsname%
    \csname DUrole#1\endcsname{#2}%
  \else%
    #2%
  \fi%
}

% transition (break / fancybreak / anonymous section)
\providecommand*{\DUtransition}{%
  \hspace*{\fill}\hrulefill\hspace*{\fill}
  \vskip 0.5\baselineskip
}
% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \usepackage{bookmark}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={Literate programming with Alectryon (Lean4 input)},
}

\title{Literate programming with Alectryon (Lean4 input)%
  \label{literate-programming-with-alectryon-lean4-input}}
\author{}
\date{}

%%% Body
\begin{document}
\maketitle

Alectryon supports literate programs and documents (combinations of code and prose) written in Lean4 and reStructuredText.  Here is an example written in Lean4.  It can be converted to reST, HTML, or LaTeX using the following commands:

\begin{quote}
\begin{alltt}
alectryon literate_lean4.lean
    # Lean4+reST → HTML;  produces ‘literate_lean4.html’
alectryon literate_lean4.lean --backend latex \textbackslash{}
     --latex-dialect xelatex \textbackslash{}
     -o literate_lean4.xe.tex
    # Lean4+reST → LaTeX; produces ‘literate_lean4.xe.tex’
alectryon literate_lean4.lean --backend rst
    # Lean4+reST → reST;  produces ‘literate_lean4.lean.rst’
\end{alltt}
\end{quote}

%___________________________________________________________________________
\DUtransition


\section{Running queries%
  \label{running-queries}%
}

Alectryon captures the results of \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{lean4}{\DUrole{k}{\#check}}}}}, \texttt{\DUrole{code}{\DUrole{highlight}{\DUrole{lean4}{\DUrole{k}{\#eval}}}}}, and the like:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    \PY{k+kd}{def}~\PY{n}{x}~\PY{o}{:}~\PY{n}{Nat}~\PY{o}{:=}~\PY{l+m+mi}{5}\nl
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}reduce}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{l+m+mi}{10}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    ~\PY{l+m+mi}{5}~\PY{n+nb+bp}{+}~\PY{n}{x}
  \end{txt}
\end{alectryon}

By default, these results are folded and are displayed upon hovering or clicking.  We can unfold them by default using annotations or directives:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}check}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{Nat}~\PY{o}{:}~\PY{k+kt}{Type}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    ~\PY{n}{Nat}
  \end{txt}
\end{alectryon}

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}check}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{n}{Bool}~\PY{o}{:}~\PY{k+kt}{Type}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    ~\PY{n}{Bool}\nl
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{k}{\PYZsh{}eval}
    \end{input}
    \sep
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{l+m+mi}{2}\nl
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    ~\PY{l+m+mi}{1}~\PY{n+nb+bp}{+}~\PY{l+m+mi}{1}
  \end{txt}
\end{alectryon}

Other flags can be used to control display, like \texttt{.no-in}:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{sentence}
    \begin{output}
      \begin{messages}
        \begin{message}
          \PY{k+kd}{inductive}~\PY{n}{Iff}~\PY{o}{:}~\PY{k+kt}{Prop}~\PY{n+nb+bp}{→}~\PY{k+kt}{Prop}~\PY{n+nb+bp}{→}~\PY{k+kt}{Prop}\nl
          \PY{n}{number}~\PY{n}{of}~\PY{k+kd}{parameters}\PY{o}{:}~\PY{l+m+mi}{2}\nl
          \PY{n}{constructors}\PY{o}{:}\nl
          \PY{n}{Iff.intro}~\PY{o}{:}~\PY{n+nb+bp}{∀}~\PY{o}{\PYZob{}}\PY{n}{a}~\PY{n}{b}~\PY{o}{:}~\PY{k+kt}{Prop}\PY{o}{\PYZcb{},}~\PY{o}{(}\PY{n}{a}~\PY{n+nb+bp}{→}~\PY{n}{b}\PY{o}{)}~\PY{n+nb+bp}{→}~\PY{o}{(}\PY{n}{b}~\PY{n+nb+bp}{→}~\PY{n}{a}\PY{o}{)}~\PY{n+nb+bp}{→}~\PY{o}{(}\PY{n}{a}~\PY{n+nb+bp}{↔}~\PY{n}{b}\PY{o}{)}
        \end{message}
      \end{messages}
    \end{output}
  \end{sentence}
  \sep
  \begin{txt}
    ~\PY{n}{Iff}
  \end{txt}
\end{alectryon}


\section{Documenting proofs%
  \label{documenting-proofs}%
}

Alectryon also captures goals and hypotheses as proofs progress:

\begin{alectryon}
  % Generator: Alectryon
  \sep
  \begin{txt}
    \PY{k+kd}{theorem}~\PY{n}{test}~\PY{o}{(}\PY{n}{p}~\PY{n}{q}~\PY{o}{:}~\PY{k+kt}{Prop}\PY{o}{)}~\PY{o}{(}\PY{n}{hp}~\PY{o}{:}~\PY{n}{p}\PY{o}{)}~\PY{o}{(}\PY{n}{hq}~\PY{o}{:}~\PY{n}{q}\PY{o}{):}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{↔}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{o}{:=}
  \end{txt}
  \sep
  \begin{sentence}
    \begin{input}
      ~\PY{k+kd}{by}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{↔}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n}{apply}~\PY{n}{Iff.intro}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp}}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{→}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q}{\PY{k+kt}{Prop}}
              \sep
              \hyp{hp}{\PY{n}{p}}
              \sep
              \hyp{hq}{\PY{n}{q}}
            \end{hyps}
            \sep
            \infrule{\gid{mpr}}
            \sep
            \begin{conclusion}
              \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{n+nb+bp}{→}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp}}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}~\PY{n+nb+bp}{→}~\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{intro}~\PY{n}{h}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp}}
          \sep
          \begin{conclusion}
            \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{n}{And.intro}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp.left}}
          \sep
          \begin{conclusion}
            \PY{n}{q}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q}{\PY{k+kt}{Prop}}
              \sep
              \hyp{hp}{\PY{n}{p}}
              \sep
              \hyp{hq}{\PY{n}{q}}
              \sep
              \hyp{h}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
            \end{hyps}
            \sep
            \infrule{\gid{mp.right}}
            \sep
            \begin{conclusion}
              \PY{n}{p}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp.left}}
          \sep
          \begin{conclusion}
            \PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{exact}~\PY{n}{hq}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{Goals}~\PY{n}{accomplished}\PY{n+nb+bp}{!}~\PY{n+nb+bp}{🐙}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mp.right}}
          \sep
          \begin{conclusion}
            \PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{exact}~\PY{n}{hp}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{Goals}~\PY{n}{accomplished}\PY{n+nb+bp}{!}~\PY{n+nb+bp}{🐙}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
          \end{hyps}
          \sep
          \infrule{\gid{mpr}}
          \sep
          \begin{conclusion}
            \PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}~\PY{n+nb+bp}{→}~\PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{intro}~\PY{n}{h}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{\gid{mpr}}
          \sep
          \begin{conclusion}
            \PY{n}{p}~\PY{n+nb+bp}{∧}~\PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n}{apply}~\PY{n}{And.intro}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{\gid{mpr.left}}
          \sep
          \begin{conclusion}
            \PY{n}{p}
          \end{conclusion}
        \end{goal}
        \sep
        \begin{extragoals}
          \begin{goal}
            \begin{hyps}
              \hyp{p, q}{\PY{k+kt}{Prop}}
              \sep
              \hyp{hp}{\PY{n}{p}}
              \sep
              \hyp{hq}{\PY{n}{q}}
              \sep
              \hyp{h}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
            \end{hyps}
            \sep
            \infrule{\gid{mpr.right}}
            \sep
            \begin{conclusion}
              \PY{n}{q}
            \end{conclusion}
          \end{goal}
        \end{extragoals}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{\gid{mpr.left}}
          \sep
          \begin{conclusion}
            \PY{n}{p}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{exact}~\PY{n}{hp}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{Goals}~\PY{n}{accomplished}\PY{n+nb+bp}{!}~\PY{n+nb+bp}{🐙}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      ~~~~\PY{n+nb+bp}{.}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}
            \hyp{p, q}{\PY{k+kt}{Prop}}
            \sep
            \hyp{hp}{\PY{n}{p}}
            \sep
            \hyp{hq}{\PY{n}{q}}
            \sep
            \hyp{h}{\PY{n}{q}~\PY{n+nb+bp}{∧}~\PY{n}{p}}
          \end{hyps}
          \sep
          \infrule{\gid{mpr.right}}
          \sep
          \begin{conclusion}
            \PY{n}{q}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
  \sep
  \begin{sentence}
    \begin{input}
      \PY{n}{exact}~\PY{n}{hq}
    \end{input}
    \sep
    \begin{output}
      \begin{goals}
        \begin{goal}
          \begin{hyps}\end{hyps}
          \sep
          \infrule{}
          \sep
          \begin{conclusion}
            \PY{n}{Goals}~\PY{n}{accomplished}\PY{n+nb+bp}{!}~\PY{n+nb+bp}{🐙}
          \end{conclusion}
        \end{goal}
      \end{goals}
    \end{output}
  \end{sentence}
\end{alectryon}

\end{document}
